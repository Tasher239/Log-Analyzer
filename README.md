# Лог-анализатор NGINX

Analyzer - это консольная утилита для анализа и подсчета статистики по лог-файлам в формате Nginx.

---

## 1. Общая информация

**Analyzer** — инструмент для анализа логов сервера NGINX. Программа позволяет:
- Подсчитать количество запросов.
- Определить наиболее часто запрашиваемые ресурсы.
- Посчитать наиболее встречающиеся коды ответа.
- Рассчитать средний размер ответа сервера и 95-й перцентиль.

---

## 2. Настройки запуска

### 2.1 Параметры запуска

Для запуска утилиты необходимо указать путь к лог-файлам:

- **Шаблон пути к файлу/папке**: Укажите путь к файлам с использованием шаблона или укажите точный путь.
- **URL ссылка на файл**: Логи можно загрузить непосредственно через URL.

#### Опциональные параметры:

- `--from` - Время в формате **ISO8601** ("YYYY-MM-DD HH:MM:SS") для фильтрации логов по времени (начало).
- `--to` - Время в формате **ISO8601** ("YYYY-MM-DD HH:MM:SS") для фильтрации логов по времени (конец).
- `--format` - Формат визуализации статистики: `markdown`, `adoc`.
- `--filter-field` - Поле для фильтрации логов.
- `--filter-value` - Значение для фильтрации по полю.

### 2.2 Названия полей для фильтрации:

- `--remote_addr` - IP-адрес клиента.
- `--remote_user` - Пользователь.
- `--time_local` - Время запроса.
- `--method` - HTTP метод.
- `--source` - Источник запроса.
- `--protocol` - Протокол.
- `--status` - HTTP статус ответа.
- `--body_bytes_sent` - Количество байт в ответе.
- `--http_referer` - Реферер.
- `--http_user_agent` - Пользовательский агент.

---

## 3. Возвращаемая статистика

После анализа логов будет предоставлена следующая информация:

- **Имя файла**: Файл(-ы) логов.
- **Дата начала и окончания логов**: Промежуток времени, охватываемый логами.
- **Суммарное количество записей**: Общее количество записей в логах.
- **Средний размер ответа**: Средний размер ответа от сервера.
- **95-й процентиль размера ответа**: 95-й процентиль для размера ответа.
- **Количество запросов по ресурсам**: Статистика по ресурсам (например, страницам).
- **Статистика по кодам ответа**: Разбивка по кодам статуса HTTP.
- **Статистика по IP-адресам**: Частота запросов с различных IP-адресов.
- **Список ресурсов с ошибками**: Ресурсы с ошибками (коды ответа 4xx и 5xx).

---

## 4. Примеры запуска (NGINX логи)

### Пример 1: Анализ локального лог-файла

```bash
PYTHONPATH=. python src/main.py --path src/data/mini_logs.txt
```
### Пример 2: Фильтрация логов по времени и статусу с выводом в формате markdown

```bash
PYTHONPATH=. python src/main.py --path src/data/mini_logs.txt --from 2024-11-09 --to 2024-11-10 --format markdown --filter-field status --filter-value 200
```

### Пример 3: Анализ логов с удаленного URL

```bash
PYTHONPATH=. python src/main.py --path https://raw.githubusercontent.com/elastic/examples/master/Common%20Data%20Formats/nginx_logs/nginx_logs
```

## 5. Результаты анализа

### 1. Пример вывода в формате Markdown

```markdown
#### Общая информация

|        Метрика        |               Значение|
|:---------------------:|----------------------:|
|       Файл(-ы)        | src/data/mini_logs.txt|
|    Начальная дата     |                      -|
|     Конечная дата     |                      -|
|  Количество запросов  |                      5|
| Средний размер ответа |               3_900.40|
|  95p размера ответа   |               6_566.80|

#### Запрашиваемые ресурсы

|    Ресурс     |  Количество|
|:-------------:|-----------:|
|   `/delete`   |           1|
| `/index.html` |           1|
|   `/login`    |           1|
| `/about.html` |           1|
|`/contact.html`|           1|

#### Коды ответа

| Код |          Имя          |  Количество|
|:---:|:---------------------:|-----------:|
| 200 |          OK           |           3|
| 404 |       Not Found       |           1|
| 500 | Internal Server Error |           1|

#### Статистика по запросам

| Тип запроса | Количество |
|:-----------:|:----------:|
|   DELETE    |           1|
|     GET     |           3|
|    POST     |           1|

#### Статистика по IP-адресам

| IP-адрес  |  Кол-во запросов|
|:---------:|:---------------:|
| 127.0.0.5 |                1|
| 127.0.0.1 |                1|
| 127.0.0.2 |                1|
| 127.0.0.3 |                1|
| 127.0.0.4 |                1|

#### Ресурсы с ошибками

/delete, /about.html
```

### 2. Пример вывода в формате Adoc

```asciidoc
=== Общая информация

* **Файлы:** src/data/mini_logs.txt
* **Начальная дата:** -
* **Конечная дата:** -
* **Количество запросов:** 5
* **Средний размер ответа:** 3_900.40
* **95-й перцентиль размера ответа:** 6_566.80

=== Запрашиваемые ресурсы

[options="header"]
|===
|Ресурс |Количество
|`/delete` |1
|`/index.html` |1
|`/login` |1
|`/about.html` |1
|`/contact.html` |1
|===

=== Коды ответа

[options="header"]
|===
|Код |Имя |Количество
|200 |OK |3
|404 |Not Found |1
|500 |Internal Server Error |1
|===

=== Статистика по запросам

[options="header"]
|===
|Тип запроса |Количество
|DELETE |1
|GET |3
|POST |1
|===

=== Статистика по IP-адресам

[options="header"]
|===
|IP-адрес |Количество запросов
|127.0.0.5 |1
|127.0.0.1 |1
|127.0.0.2 |1
|127.0.0.3 |1
|127.0.0.4 |1
|===

=== Ресурсы с ошибками

`/about.html`, `/delete`
```
